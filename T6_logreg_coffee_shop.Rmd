**====================================================================================**

# Coffee Shop Purchasing Association Analysis  
Noah MacGillivray | BIT-446 Assignment(T6) | Summer 2025 

Logistic Regression Classification 

**Environment:** Ubuntu, VS Code

**====================================================================================**

## Introduction
This program imports 


## Required Packages 
```{r}
# Load packages
library(readxl)
library(class)
library(caTools)
library(caret)
library(ggplot2)
library(lattice)
library(metrica)
library(skimr)
library(knitr)
library(kableExtra)
library(fmsb)

cat("All packages loaded successfully!\n")
```

## Data Import and Conversion
The coffee shop data which includes three different sheets including the training/testing
data ("TrainTestData"), the new data for predictions ("NewData"), and a sheet related to the 
data information ("Info"). The three sheets are read in and placed in a list and then 
distributed to three different data field variables. The target variable ("LatteDonut") 
in the training/testing data is then converted to a factor type to allow other packages 
below to analyze the results. This was done before splitting to allow for further testing 
as needed. 

```{r}

# Read in sheet names
sheet_names <- excel_sheets("BIT-446-RS-T6-Lattes1.xlsx")
print(sheet_names)

all_sheets <- list()

for (sheet in sheet_names) {
    all_sheets[[sheet]] <- read_excel("BIT-446-RS-T6-Lattes1.xlsx", sheet = sheet) # nolint
}
# Variable to hold the training data
lattes <- all_sheets[[1]]

# Variable to hold the final predictions data
lattes_new <- all_sheets[[2]]

# Variable to hold the data sheets information
data_info <- all_sheets[[3]]

# Convert target variable to factor (only for the training data)
lattes$LatteDonut <- as.factor(lattes$LatteDonut)
lattes$LatteDonut <- relevel(lattes$LatteDonut, ref = "0")
```

## Raw Data Summary
TODO

```{r}
#Print the TrainTestData sheet
cat("TrainTestData Sheet\n")
print(lattes)

# Print NewData sheet
cat("NewData Sheet\n")
print(lattes_new)

# Print data info via kableExtra package
kable(data_info,
      caption = "Data Info",
      col.names = c("Variable", "Definition")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
                full_width = FALSE)

# Loops through all sheets imported and prints the tails 
for (x in sheet_names) {
  cat("Sheet:", x, "\n")
  print(tail(all_sheets[[x]]))
  cat("\n")
}

# Loops through the first two sheets and prints the Skim summary
for (x in sheet_names[-length(sheet_names)]) {
  cat("=== Skim Summary for Sheet:", x, "===\n")
  print(skim(all_sheets[[x]]))
  cat("\n")
}

```



## General Impressions From Summary 
TODO


## Data Splitting for ***Stratified*** Logistic Regression (LR) Training 
Seed was set for reproducibility; data was split using random stratified approach 
(random selection, but each train/test division has equal number of the target variable- 
LatteDonut). 80% for training and 20% for testing.  

```{r}

# Set seed for reproducible results
set.seed(3)

# Stratified random split 80/20
split <- sample.split(lattes$LatteDonut, SplitRatio = 0.8)

# Distribute the split data to training and testing
train_latte_donut <- subset(lattes, split == TRUE)
test_latte_donut <- subset(lattes, split == FALSE)

# Confirm the data was split correctly
print(train_latte_donut)
print(test_latte_donut)

```

## Train logistic regression classification model
This is where we create the *logistic regression classification model* with:  
- **Features**: Age, EstMonthsCustomer, and EstMonthsCustomer  
- **Target**: LatteDonut 

```{r}
late_donut_lr_model <- glm(LatteDonut ~ Age + EstMonthsCustomer + EstSalary,
                           data = train_latte_donut,
                           family = binomial)
```

## Model Information and Summary

```{r}
# View model summary
summary(late_donut_lr_model)

# Calculate Nagelkerke R-squared value
nagelkerke_r2 <- NagelkerkeR2(late_donut_lr_model)
print(nagelkerke_r2)

var_importance <- varImp(late_donut_lr_model)
print(var_importance)
```

## Validate the Model 

```{r}

prediction <- predict(late_donut_lr_model, newdata = test_latte_donut, type = "response") 

prediction <- ifelse(prediction > 0.5, "1", "0")

# Convert to factor for comparison
prediction <- as.factor(prediction)

prediction <- as.data.frame(prediction)
```